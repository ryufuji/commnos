# Commons ユーザーフロー完全分析

## 1. プラットフォームオーナー（テナント作成者）のフロー

### 1.1 初回登録・テナント作成
- ✅ **GET /**: ランディングページ
- ✅ **GET /register**: 新規登録ページ（テナント作成）
- ✅ **POST /api/auth/register**: 登録API
- ✅ **自動処理**: ユーザー作成 + テナント作成 + オーナー権限付与
- ✅ **リダイレクト**: /dashboard

### 1.2 ログイン
- ✅ **GET /login**: ログインページ
- ✅ **POST /api/auth/login**: ログインAPI
- ✅ **リダイレクト**: /dashboard

### 1.3 ダッシュボード
- ✅ **GET /dashboard**: メインダッシュボード
- ✅ **統計表示**: メンバー数、投稿数、コメント数
- ✅ **クイックアクション**: 投稿管理へのリンク

### 1.4 会員管理（管理者側）
- ✅ **GET /members**: 会員管理ページ
- ✅ **承認待ちリスト**: 申請者の表示
- ✅ **承認済みリスト**: アクティブ会員の表示
- ✅ **PUT /api/members/:id/approve**: 会員承認API
- ✅ **PUT /api/members/:id/reject**: 会員拒否API
- ✅ **メール通知**: 承認・拒否のメール送信

### 1.5 プロフィール管理
- ✅ **GET /profile**: プロフィールページ
- ✅ **PUT /api/profile**: プロフィール更新API
- ✅ **POST /api/upload/image**: アバター画像アップロード

### 1.6 投稿管理（管理者として）
- ✅ **投稿作成**: POST /api/posts（管理者権限で実装済み）
- ✅ **投稿編集**: PUT /api/posts/:id
- ✅ **投稿削除**: DELETE /api/posts/:id

---

## 2. テナント会員のフロー

### 2.1 初回訪問・会員登録 ❌ **実装漏れ！**
- ✅ **GET /tenant/home?subdomain=xxx**: テナントホームページ（実装済み）
- ❌ **GET /tenant/register**: 会員登録ページ（未実装）
- ❌ **POST /api/tenant/register**: 会員登録API（未実装）
- ❌ **承認待ち画面**: 申請後の案内ページ（未実装）
- ✅ **メール通知**: 管理者への申請通知（Phase 2で実装済み）

### 2.2 会員ログイン ❌ **実装漏れ！**
- ❌ **GET /tenant/login**: 会員ログインページ（未実装）
- ❌ **POST /api/tenant/login**: 会員ログインAPI（未実装）
- ❌ **認証チェック**: テナント会員専用のセッション管理（未実装）

### 2.3 ログイン後のホーム
- ✅ **GET /tenant/home**: テナントホーム（実装済み）
- ✅ **統計表示**: メンバー数、投稿数、設立年
- ✅ **最新投稿**: 6件表示
- ❌ **ログイン状態の表示**: 「ログイン」→「マイページ」に変更（未実装）

### 2.4 投稿閲覧
- ✅ **GET /tenant/posts**: 投稿一覧ページ
- ✅ **GET /tenant/posts/:id**: 投稿詳細ページ
- ✅ **ページネーション**: 12件/ページ
- ✅ **閲覧数カウント**: 自動増加

### 2.5 投稿作成 ⚠️ **認証が不完全**
- ✅ **GET /tenant/posts/new**: 投稿作成ページ（実装済み）
- ✅ **POST /api/posts**: 投稿作成API（実装済み）
- ❌ **認証チェック**: ログインしていない場合のリダイレクト（未実装）
- ✅ **画像アップロード**: サムネイル対応
- ✅ **下書き保存**: status='draft'

### 2.6 会員一覧・プロフィール閲覧
- ✅ **GET /tenant/members**: 会員一覧ページ
- ✅ **GET /tenant/members/:id**: 会員プロフィール詳細ページ
- ✅ **統計表示**: 投稿数、コメント数、閲覧数

### 2.7 マイページ ❌ **未実装**
- ❌ **GET /tenant/my**: マイページ（未実装）
- ❌ **自分の投稿一覧**: 公開済み・下書き（未実装）
- ❌ **自分のコメント一覧**: 投稿へのコメント（未実装）
- ❌ **アクティビティ履歴**: 最近の活動（未実装）

### 2.8 プロフィール編集 ❌ **未実装**
- ❌ **GET /tenant/profile/edit**: プロフィール編集ページ（未実装）
- ❌ **PUT /api/tenant/profile**: プロフィール更新API（未実装）
- ❌ **アバター変更**: 画像アップロード（未実装）

### 2.9 コメント機能 ❌ **フロントエンド未実装**
- ✅ **POST /api/comments**: コメント作成API（Phase 2で実装済み）
- ❌ **投稿詳細ページでのコメント表示**: UI未実装
- ❌ **コメント投稿フォーム**: UI未実装

### 2.10 通知 ❌ **未実装**
- ❌ **GET /tenant/notifications**: 通知一覧ページ（未実装）
- ❌ **通知センター**: ヘッダーのベルアイコン（未実装）
- ❌ **未読バッジ**: 新着通知の数（未実装）

---

## 3. ゲスト訪問者のフロー

### 3.1 テナントの閲覧
- ✅ **GET /tenant/home**: テナントホーム（誰でも閲覧可能）
- ✅ **GET /tenant/posts**: 投稿一覧（誰でも閲覧可能）
- ✅ **GET /tenant/posts/:id**: 投稿詳細（誰でも閲覧可能）
- ✅ **GET /tenant/members**: 会員一覧（誰でも閲覧可能）
- ⚠️ **投稿作成**: ログインが必要（認証チェック強化が必要）

### 3.2 会員登録への誘導
- ⚠️ **ヘッダーの「会員登録」ボタン**: 現在は「ログイン」のみ（要追加）
- ⚠️ **ヒーローセクションのCTA**: 「メンバー申請」ボタン実装済みだがリンク先未設定

---

## 🔴 重大な実装漏れ

### 最優先（Phase 2の実装漏れ）
1. ❌ **テナント会員登録ページ**: `/tenant/register`
2. ❌ **テナント会員ログインページ**: `/tenant/login`
3. ❌ **会員登録API**: `POST /api/tenant/register`
4. ❌ **会員ログインAPI**: `POST /api/tenant/login`（既存のログインAPIとは別）
5. ❌ **承認待ち画面**: 申請後の案内

### 高優先（Phase 3の実装漏れ）
6. ❌ **マイページ**: `/tenant/my`
7. ❌ **プロフィール編集**: `/tenant/profile/edit`
8. ❌ **コメント機能のフロントエンド**: 投稿詳細ページに追加
9. ❌ **認証チェック**: 投稿作成・編集時のログイン確認

### 中優先（Phase 3-4で実装予定）
10. ❌ **通知センター**: ヘッダーのベルアイコン
11. ❌ **検索機能**: 投稿・会員の検索
12. ❌ **いいね機能**: 投稿へのいいね（UI準備済み）
13. ❌ **シェア機能**: ソーシャルシェア（UI準備済み）

---

## 推奨される実装順序

### Step 1: 会員の入口を作る（最優先）
1. テナント会員登録ページ (`/tenant/register`)
2. テナント会員ログインページ (`/tenant/login`)
3. 会員登録・ログインAPI
4. ナビゲーション更新（「会員登録」ボタン追加）

### Step 2: 認証チェックの強化
5. 投稿作成ページの認証チェック
6. ログイン状態の表示（ヘッダー）
7. ログアウト機能

### Step 3: マイページ機能
8. マイページ実装
9. プロフィール編集機能
10. 自分の投稿・コメント一覧

### Step 4: コメント機能のフロントエンド
11. 投稿詳細ページにコメント表示
12. コメント投稿フォーム
13. 返信機能

### Step 5: 通知・検索など
14. 通知センター
15. 検索機能
16. いいね・シェア機能

---

## 結論

**現在の状況:**
- Phase 1-2: プラットフォームオーナー側は完成度高い ✅
- Phase 3: テナント会員向けページは作ったが、**入口がない** ❌

**最優先タスク:**
テナント会員の登録・ログイン機能を今すぐ実装する必要があります。
